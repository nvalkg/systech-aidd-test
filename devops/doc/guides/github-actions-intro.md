# –í–≤–µ–¥–µ–Ω–∏–µ –≤ GitHub Actions

–ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ Docker –æ–±—Ä–∞–∑–æ–≤.

## –ß—Ç–æ —Ç–∞–∫–æ–µ GitHub Actions

**GitHub Actions** - —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è CI/CD –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ GitHub, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä—è–º–æ –≤ –≤–∞—à–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

- **Workflow (—Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å)** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤ YAML —Ñ–∞–π–ª–µ
- **Job (–∑–∞–¥–∞—á–∞)** - –Ω–∞–±–æ—Ä —à–∞–≥–æ–≤, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –Ω–∞ –æ–¥–Ω–æ–º runner
- **Step (—à–∞–≥)** - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –∏–ª–∏ action
- **Action** - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –º–æ–¥—É–ª—å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á
- **Runner** - –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è workflows

### –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è workflows

–í—Å–µ workflows —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `.github/workflows/` –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

```
.github/
‚îî‚îÄ‚îÄ workflows/
    ‚îú‚îÄ‚îÄ quality.yml    # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
    ‚îú‚îÄ‚îÄ build.yml      # —Å–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–æ–≤
    ‚îî‚îÄ‚îÄ deploy.yml     # —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (–±—É–¥–µ—Ç –≤ D3)
```

## –¢—Ä–∏–≥–≥–µ—Ä—ã (—Å–æ–±—ã—Ç–∏—è)

Workflows –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö:

### pull_request

–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Pull Request:

```yaml
on:
  pull_request:
    branches: [main]  # —Ç–æ–ª—å–∫–æ –¥–ª—è PR –≤ main –≤–µ—Ç–∫—É
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ª–æ–º–∞—é—Ç —Å–±–æ—Ä–∫—É.

### push

–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ push –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤–µ—Ç–∫–∏:

```yaml
on:
  push:
    branches:
      - main
      - develop
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å–ª–µ –º–µ—Ä–¥–∂–∞.

### workflow_dispatch

–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ workflow —á–µ—Ä–µ–∑ GitHub UI:

```yaml
on:
  workflow_dispatch:  # –∫–Ω–æ–ø–∫–∞ "Run workflow" –≤ GitHub
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –†—É—á–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é.

### –ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

```yaml
on:
  pull_request:
    branches: [main]
  push:
    branches: [main]
  workflow_dispatch:
```

## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã —Å Pull Requests

### Workflow –¥–ª—è PR

```yaml
name: PR Checks

on:
  pull_request:
    branches: [main]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run checks
        run: make quality
```

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª PR

1. **–°–æ–∑–¥–∞–Ω–∏–µ PR** ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è workflow
2. **Push –Ω–æ–≤—ã—Ö –∫–æ–º–º–∏—Ç–æ–≤** ‚Üí Workflow –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
3. **–ü—Ä–æ–≤–µ—Ä–∫–∏ passed** ‚Üí –ú–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å merge
4. **Merge –≤ main** ‚Üí –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è workflow –¥–ª—è main –≤–µ—Ç–∫–∏

### –°—Ç–∞—Ç—É—Å—ã –ø—Ä–æ–≤–µ—Ä–æ–∫

- ‚úÖ **Success** - –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—à–ª–∏
- ‚ùå **Failed** - –µ—Å—Ç—å –æ—à–∏–±–∫–∏
- üü° **In Progress** - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- ‚ö™ **Pending** - –≤ –æ—á–µ—Ä–µ–¥–∏

## Matrix Strategy

**Matrix strategy** –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –æ–¥–Ω—É –∏ —Ç—É –∂–µ job —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

### –ü—Ä–∏–º–µ—Ä: —Å–±–æ—Ä–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–±—Ä–∞–∑–æ–≤

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        service:
          - name: bot
            dockerfile: devops/Dockerfile.bot
            image: aidd-bot
          - name: api
            dockerfile: devops/Dockerfile.api
            image: aidd-api
          - name: frontend
            dockerfile: devops/Dockerfile.frontend
            image: aidd-frontend

    steps:
      - name: Build ${{ matrix.service.name }}
        run: |
          docker build -f ${{ matrix.service.dockerfile }} \
            -t ${{ matrix.service.image }} .
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ matrix

- ‚ö° **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** - –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- üìù **–ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞** - –æ–¥–Ω–∞ job –≤–º–µ—Å—Ç–æ —Ç—Ä–µ—Ö
- üîÑ **–õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã** - –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –≤ –º–∞—Å—Å–∏–≤

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. GitHub Actions —Å–æ–∑–¥–∞–µ—Ç **–æ—Ç–¥–µ–ª—å–Ω—É—é job** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –º–∞—Ç—Ä–∏—Ü—ã
2. –í—Å–µ jobs –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** –Ω–∞ —Ä–∞–∑–Ω—ã—Ö runners
3. –î–æ—Å—Ç—É–ø –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º —á–µ—Ä–µ–∑ `${{ matrix.service.name }}`

## GitHub Container Registry (ghcr.io)

**GitHub Container Registry** - —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Docker registry –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤.

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **–ê–¥—Ä–µ—Å:** `ghcr.io`
- **–§–æ—Ä–º–∞—Ç –æ–±—Ä–∞–∑–∞:** `ghcr.io/<username>/<image>:<tag>`
- **–ü—Ä–∏–º–µ—Ä:** `ghcr.io/myuser/aidd-bot:latest`

### –ü—É–±–ª–∏—á–Ω—ã–µ vs –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –æ–±—Ä–∞–∑—ã

#### –ü—É–±–ª–∏—á–Ω—ã–µ –æ–±—Ä–∞–∑—ã (Public)

- ‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ú–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å: `docker pull ghcr.io/user/image:tag`
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è `docker login`
- ‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è open source –ø—Ä–æ–µ–∫—Ç–æ–≤

#### –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –æ–±—Ä–∞–∑—ã (Private)

- üîí –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- üîí –ù—É–∂–µ–Ω `docker login ghcr.io`
- üîí –î–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

### –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –æ–±—Ä–∞–∑ –ø—É–±–ª–∏—á–Ω—ã–º

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–±—Ä–∞–∑–∞:

1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://github.com/USERNAME?tab=packages
2. –í—ã–±—Ä–∞—Ç—å –ø–∞–∫–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `aidd-bot`)
3. **Package settings** ‚Üí **Danger Zone** ‚Üí **Change visibility**
4. –í—ã–±—Ä–∞—Ç—å **Public**
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ workflow

GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω `GITHUB_TOKEN`:

```yaml
- name: Login to GitHub Container Registry
  uses: docker/login-action@v3
  with:
    registry: ghcr.io
    username: ${{ github.repository_owner }}
    password: ${{ secrets.GITHUB_TOKEN }}
```

**–í–∞–∂–Ω–æ:** –î–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ `packages: write`.

## Permissions –≤ GitHub Actions

Workflows –¥–æ–ª–∂–Ω—ã —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —Ç—Ä–µ–±—É–µ–º—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:

```yaml
jobs:
  build:
    runs-on: ubuntu-latest

    permissions:
      contents: read      # —á—Ç–µ–Ω–∏–µ –∫–æ–¥–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      packages: write     # –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–æ–≤ –≤ GHCR

    steps:
      # ...
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∞

- `contents: read` - —á—Ç–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- `contents: write` - –∑–∞–ø–∏—Å—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–∫–æ–º–º–∏—Ç—ã, —Ç–µ–≥–∏)
- `packages: read` - —á—Ç–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –∏–∑ registry
- `packages: write` - –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø–∞–∫–µ—Ç–æ–≤ –≤ registry
- `pull-requests: write` - —Å–æ–∑–¥–∞–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ PR

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π GITHUB_TOKEN

GitHub –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ workflow:

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- ‚úÖ –ò—Å—Ç–µ–∫–∞–µ—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è workflow
- ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ `${{ secrets.GITHUB_TOKEN }}`
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```yaml
- name: Login to GHCR
  uses: docker/login-action@v3
  with:
    registry: ghcr.io
    username: ${{ github.repository_owner }}
    password: ${{ secrets.GITHUB_TOKEN }}
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- ‚ùå –ù–µ –º–æ–∂–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å –¥—Ä—É–≥–∏–µ workflows (–∑–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤)
- ‚ùå –ü—Ä–∞–≤–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- ‚úÖ –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–¥–∞—á –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

## –£—Å–ª–æ–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —à–∞–≥–æ–≤

–ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å —à–∞–≥–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö:

### –ü—Ä–∏–º–µ—Ä: –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ push

```yaml
- name: Login to GHCR
  if: github.event_name == 'push'  # —Ç–æ–ª—å–∫–æ –¥–ª—è push, –Ω–µ –¥–ª—è PR
  uses: docker/login-action@v3
  with:
    registry: ghcr.io
    username: ${{ github.repository_owner }}
    password: ${{ secrets.GITHUB_TOKEN }}

- name: Build and push
  uses: docker/build-push-action@v5
  with:
    push: ${{ github.event_name == 'push' }}  # –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ push
    tags: |
      ghcr.io/${{ github.repository_owner }}/aidd-bot:latest
```

### –ü–æ–ª–µ–∑–Ω—ã–µ —É—Å–ª–æ–≤–∏—è

- `github.event_name == 'push'` - —Å–æ–±—ã—Ç–∏–µ push
- `github.event_name == 'pull_request'` - —Å–æ–±—ã—Ç–∏–µ PR
- `github.ref == 'refs/heads/main'` - –≤–µ—Ç–∫–∞ main
- `success()` - –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —à–∞–≥–∏ —É—Å–ø–µ—à–Ω—ã
- `failure()` - —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —à–∞–≥ failed

## –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Docker —Å–ª–æ–µ–≤

–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–±–æ—Ä–∫–∏:

```yaml
- name: Build and push
  uses: docker/build-push-action@v5
  with:
    context: .
    file: devops/Dockerfile.bot
    push: ${{ github.event_name == 'push' }}
    tags: ghcr.io/${{ github.repository_owner }}/aidd-bot:latest
    cache-from: type=registry,ref=ghcr.io/${{ github.repository_owner }}/aidd-bot:buildcache
    cache-to: type=registry,ref=ghcr.io/${{ github.repository_owner }}/aidd-bot:buildcache,mode=max
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚ö° –ë—ã—Å—Ç—Ä–µ–µ —Å–±–æ—Ä–∫–∞ (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ–∏)
- üí∞ –ú–µ–Ω—å—à–µ —Ä–∞—Å—Ö–æ–¥ —Ä–µ—Å—É—Ä—Å–æ–≤
- üîÑ –ö—ç—à —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ registry

## –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ–≥–∏

```yaml
tags: |
  ghcr.io/${{ github.repository_owner }}/aidd-bot:latest
  ghcr.io/${{ github.repository_owner }}/aidd-bot:${{ github.sha }}
```

- `latest` - –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
- `${{ github.sha }}` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–º–º–∏—Ç (–ø–æ–ª–Ω—ã–π SHA)
- `${{ github.ref_name }}` - –∏–º—è –≤–µ—Ç–∫–∏ –∏–ª–∏ —Ç–µ–≥–∞
- `v1.0.0` - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –í—Å–µ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
docker pull ghcr.io/user/aidd-bot:latest

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–º–º–∏—Ç (–≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å)
docker pull ghcr.io/user/aidd-bot:abc123def456...

# –í–µ—Ä—Å–∏—è —Ä–µ–ª–∏–∑–∞
docker pull ghcr.io/user/aidd-bot:v1.0.0
```

## –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –í–∫–ª–∞–¥–∫–∞ **Actions**
3. –í—ã–±—Ä–∞—Ç—å workflow run
4. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ job
5. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π step

### –û—Ç–ª–∞–¥–∫–∞

```yaml
- name: Debug info
  run: |
    echo "Event: ${{ github.event_name }}"
    echo "Branch: ${{ github.ref_name }}"
    echo "SHA: ${{ github.sha }}"
    echo "Actor: ${{ github.actor }}"
```

### Useful context variables

- `github.event_name` - —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è (push, pull_request)
- `github.ref` - –ø–æ–ª–Ω–∞—è —Å—Å—ã–ª–∫–∞ (refs/heads/main)
- `github.ref_name` - –∏–º—è –≤–µ—Ç–∫–∏ (main)
- `github.sha` - SHA –∫–æ–º–º–∏—Ç–∞
- `github.repository_owner` - –≤–ª–∞–¥–µ–ª–µ—Ü —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- `github.actor` - –∫—Ç–æ –∑–∞–ø—É—Å—Ç–∏–ª workflow

## Best Practices

### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ actions

```yaml
# ‚úÖ –•–æ—Ä–æ—à–æ - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è
- uses: actions/checkout@v4

# ‚ùå –ü–ª–æ—Ö–æ - latest –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å workflow
- uses: actions/checkout@latest
```

### 2. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ permissions

```yaml
# ‚úÖ –•–æ—Ä–æ—à–æ - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞
permissions:
  contents: read
  packages: write

# ‚ùå –ü–ª–æ—Ö–æ - –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–∞–≤–∞
permissions: write-all
```

### 3. –ö—ç—à–∏—Ä—É–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```yaml
- uses: actions/cache@v3
  with:
    path: ~/.cache/pip
    key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
```

### 4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ secrets –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```yaml
# ‚úÖ –•–æ—Ä–æ—à–æ
password: ${{ secrets.DATABASE_PASSWORD }}

# ‚ùå –ü–ª–æ—Ö–æ - —Ö–∞—Ä–¥–∫–æ–¥ —Å–µ–∫—Ä–µ—Ç–æ–≤
password: "my-secret-password"
```

### 5. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –≤–µ—Ç–∫–∞—Ö –ø–µ—Ä–µ–¥ main

```yaml
on:
  push:
    branches:
      - main
      - 'feature/**'  # —Ç–µ—Å—Ç–æ–≤—ã–µ –≤–µ—Ç–∫–∏
```

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è GitHub Actions](https://docs.github.com/en/actions)
- [GitHub Container Registry](https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry)
- [Docker Build Push Action](https://github.com/docker/build-push-action)
- [Marketplace Actions](https://github.com/marketplace?type=actions)

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –≤—ã –≥–æ—Ç–æ–≤—ã:

1. ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å workflows –¥–ª—è CI/CD
2. ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–±–æ—Ä–∫—É Docker –æ–±—Ä–∞–∑–æ–≤
3. ‚úÖ –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑—ã –≤ GitHub Container Registry
4. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å matrix strategy –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏
5. ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏ –∏ —É—Å–ª–æ–≤–∏—è–º–∏

**–ü—Ä–∞–∫—Ç–∏–∫–∞:** –°–º. `.github/workflows/build.yml` –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ - –≥–æ—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä workflow –¥–ª—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤.
